{{!< default}}

{{!-- Back to top button with progress ring (shown when no TOC) --}}
<button class="back-to-top" aria-label="{{t "Back to top"}}">
	<svg class="progress-ring" viewBox="0 0 44 44">
		<circle class="progress-ring__bg" cx="22" cy="22" r="20"></circle>
		<circle class="progress-ring__progress" cx="22" cy="22" r="20"></circle>
	</svg>
	<svg class="back-to-top__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<polyline points="18 15 12 9 6 15"></polyline>
	</svg>
</button>

{{!-- Everything inside the #post tags pulls data from the post --}}
{{#post}}

{{#if feature_image}}
{{#contentFor "html_class"}}cover-active{{/contentFor}}
{{/if}}

<header class="post-header {{#if feature_image}} has-cover {{/if}}">
	<div class="inner">
		<span class="post-info">
			<span class="post-type">{{t "Article"}}</span>
			{{#if tags}}
			<span class="post-count">{{primary_tag.name}}</span>
			{{/if}}
		</span>
		<h1 class="post-title">{{{title}}}</h1>
		<div class="post-meta">
			<div class="post-meta-avatars">
				{{#foreach authors}}
					{{!-- Author avatar with SVG fallback --}}
					{{#if profile_image}}
						<figure class="post-meta-avatar">
							<a href="{{url}}" class="author-avatar">
								<picture>
									<source type="image/avif" srcset="{{img_url profile_image size="xs" format="avif" quality="80"}}" />
									<source type="image/webp" srcset="{{img_url profile_image size="xs" format="webp" quality="80"}}" />
									<img class="author-profile-image" src="{{img_url profile_image size="xs" quality="80"}}" alt="{{name}}" loading="lazy" decoding="async" />
								</picture>
							</a>
						</figure>
					{{else}}
						<figure class="post-meta-avatar avatar" aria-label="{{name}}">
							<a href="{{url}}" class="author-avatar">
								<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
									<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
								</svg>
							</a>
						</figure>
					{{/if}}
				{{/foreach}}
			</div>
			<h4 class="post-meta-author">
				{{#foreach authors}}
					{{#unless @first}}{{#if @last}} & {{else}}, {{/if}}{{/unless}}<a href="{{url}}">{{name}}</a>
				{{/foreach}}
			</h4>
			<span class="post-meta-details"><time datetime="{{date format='YYYY-MM-DD'}}">{{date format="MMM DD, YYYY"}}</time><span class="post-meta-sep" aria-hidden="true">â€¢</span><span class="post-meta-reading">{{reading_time minute=(t "1 min read") minutes=(t "% min read")}}</span></span>
		</div>
		{{#if feature_image}}
		<div class="post-cover cover">
			<picture>
				<source
					type="image/avif"
					srcset="{{> "srcset" image=feature_image format="avif" quality="50"}}"
					sizes="(max-width: 1100px) 100vw, 1100px" />
				<source
					type="image/webp"
					srcset="{{> "srcset" image=feature_image format="webp" quality="50"}}"
					sizes="(max-width: 1100px) 100vw, 1100px" />
				<source
					srcset="{{> "srcset" image=feature_image quality="50"}}"
					sizes="(max-width: 1100px) 100vw, 1100px" />
				<img
					srcset="{{> "srcset" image=feature_image quality="50"}}"
					sizes="(max-width: 1100px) 100vw, 1100px"
					src="{{img_url feature_image size="l" quality="50"}}"
					alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}"
					loading="eager"
					decoding="async"
					fetchpriority="high" />
			</picture>
		</div>
		{{/if}}
	</div>
</header>

<main class="content" role="main">
	<article class="{{post_class}}">
		<div class="inner">

			{{!-- Feature image caption/credit --}}
			{{#if feature_image_caption}}
			<figcaption class="post-cover-credit">{{{feature_image_caption}}}</figcaption>
			{{/if}}

			{{!-- Add no-toc class if #no-toc tag is present --}}
			<section class="post-content{{#has tag="#no-toc"}} no-toc{{/has}}">
				{{content}}
			</section>

		<section class="post-footer">

			{{!-- Not By AI Badge - Above all footer content --}}
			{{> "notbyai-badge"}}

			{{!-- Flexbox container for Share + Tags --}}
			<div class="post-footer-meta">
				{{#if tags}}
				<aside class="post-tags">
					<span class="post-info-label">{{t "Topic"}}</span>
					{{tags separator=" " visibility="public"}}
				</aside>
				{{/if}}

					<div class="post-share js-share-native" hidden>
						<span class="post-info-label">{{t "Share"}}</span>
						<button aria-label="{{t "Share"}} {{t "Article"}}" class="post-share-button" id="share-button"><i class="icon icon-share" aria-hidden="true">{{> "icons/icon-share"}}</i></button>
					</div>

					<div class="post-share js-share-default" hidden>
						<span class="post-info-label">{{t "Share"}}</span>
						<a title="{{t "Twitter"}}" aria-label="{{t "Twitter"}}" class="twitter" href="https://twitter.com/share?text={{encode title}}&url={{url absolute="true"}}" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
							<i class="icon icon-twitter" aria-hidden="true">{{> "icons/icon-twitter"}}</i>
						</a>
						<a title="{{t "Facebook"}}" aria-label="{{t "Facebook"}}" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u={{url absolute="true"}}" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
							<i class="icon icon-facebook" aria-hidden="true">{{> "icons/icon-facebook"}}</i>
						</a>
						<a title="{{t "LinkedIn"}}" aria-label="{{t "LinkedIn"}}" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url={{url absolute="true"}}&amp;title={{encode title}}" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;">
							<i class="icon icon-linkedin" aria-hidden="true">{{> "icons/icon-linkedin"}}</i>
						</a>
						<a title="{{t "Email"}}" aria-label="{{t "Email"}}" class="email" href="mailto:?subject={{encode title}}&amp;body={{url absolute="true"}}">
							<i class="icon icon-mail" aria-hidden="true">{{> "icons/icon-mail"}}</i>
						</a>
					</div>
				</div>

				<script>
				(function() {
					var sharePref = '{{@custom.post_share}}';
					var nativeShare = document.querySelector('.js-share-native');
					var defaultShare = document.querySelector('.js-share-default');

					// Hide both by default
					if (nativeShare) nativeShare.hidden = true;
					if (defaultShare) defaultShare.hidden = true;

					// Show only the selected share type
					if (sharePref === 'Native' && nativeShare) {
						nativeShare.hidden = false;
					} else if (sharePref === 'Default' && defaultShare) {
						defaultShare.hidden = false;
					}
					// If sharePref === 'Disabled', both remain hidden
				})();
				</script>

			</section>

			{{#if comments}}
			<section class="post-comments" data-comments-section>
				<header class="post-comments-header">
					<h3 class="post-comments-title">{{t "Comments"}}</h3>
					<span class="post-comments-count">{{comment_count autowrap="false" empty=(t "0 comments")}}</span>
				</header>
				<button class="post-comments-load js-load-comments" type="button" aria-controls="comments-container" aria-expanded="false">
					<span class="post-comments-load-label">{{t "Show Comments"}}</span>
				</button>
				<div id="comments-container" class="post-comments-container" data-comments-placeholder></div>
				<template id="ghost-comments-template">
					{{comments title="" count=false}}
				</template>
			</section>
			{{else if @custom.disqus_shortname}}
			<section class="post-comments">
				<div id="disqus_thread" data-disqus-shortname="{{@custom.disqus_shortname}}"></div>
			</section>
			{{/if}}

      {{#if @site.members_enabled}}
      <section class="post-subscribe">
        {{#unless @member}}
        	<p class="post-subscribe-text">{{#if @custom.email_signup_text}}{{@custom.email_signup_text}}{{else}}{{t "Sign up for more like this."}}{{/if}}</p>
        	{{subscribe_form placeholder=(t "Your email address") form_class="post-subscribe-form" input_class="post-subscribe-input" button_class="post-subscribe-button"}}
        {{/unless}}
      </section>
      {{/if}}

			{{> "recent-posts"}}

		</div>
	</article>
</main>

{{/post}}

{{!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs --}}
{{#if feature_image}}
{{#contentFor "head"}}
<link rel="preload"
	as="image"
	href="{{img_url feature_image size="l" quality="50"}}"
	imagesrcset="{{> "srcset" image=feature_image quality="50"}}"
	imagesizes="(max-width: 1100px) 100vw, 1100px">
{{/contentFor}}
{{/if}}
{{#contentFor "scripts"}}
<script defer src="{{asset "js/tocbot.min.js"}}"></script>
<script defer src="{{asset "js/post.js"}}" data-highlight="{{asset "js/highlight.pack.js"}}"></script>
<script>
(function() {
	var btn = document.querySelector('.back-to-top');
	var progress = btn ? btn.querySelector('.progress-ring__progress') : null;
	var content = document.querySelector('.post-content');
	var footer = document.querySelector('.nav-footer');
	if (!btn || !progress || !content) return;

	var circumference = 2 * Math.PI * 20; // r=20
	var articleTop = 0;
	var articleHeight = 0;
	var isVisible = false;
	var defaultBottom = 32; // Default bottom position in px
	var btnHeight = 48; // Button height
	var safeMargin = 16; // Extra margin from footer
	var lastScrollTop = 0;
	var isScrollingDown = false;

	function updateProgress() {
		var rect = content.getBoundingClientRect();
		articleTop = rect.top + window.pageYOffset;
		articleHeight = rect.height;

		var scrollY = window.pageYOffset;
		var windowHeight = window.innerHeight;
		var scrollableHeight = articleHeight - windowHeight;

		// Calculate progress (0 to 1)
		var progressValue = 0;
		if (scrollableHeight > 0) {
			progressValue = Math.max(0, Math.min((scrollY - articleTop + windowHeight * 0.3) / scrollableHeight, 1));
		}

		// Update progress ring
		var offset = circumference * (1 - progressValue);
		progress.style.strokeDashoffset = offset;

		// Detect scroll direction
		var scrollDelta = scrollY - lastScrollTop;
		var currentScrollingDown = scrollDelta > 0;

		// Only update if scroll direction changed and scrolled more than 5px
		if (Math.abs(scrollDelta) > 5 && currentScrollingDown !== isScrollingDown) {
			isScrollingDown = currentScrollingDown;
			updateButtonVisibility(scrollY);
		}

		lastScrollTop = scrollY;

		// Show/hide button based on scroll position
		var shouldShow = scrollY > 200;
		if (shouldShow !== isVisible) {
			isVisible = shouldShow;
			btn.classList.toggle('is-visible', shouldShow);
		}

		// Avoid footer overlap
		if (footer) {
			var footerRect = footer.getBoundingClientRect();
			var footerTop = footerRect.top;
			var btnBottom = windowHeight - defaultBottom - btnHeight;

			// If button would overlap footer, move it up
			if (footerTop < windowHeight && footerTop < btnBottom + btnHeight + safeMargin) {
				var newBottom = windowHeight - footerTop + safeMargin;
				btn.style.bottom = newBottom + 'px';
			} else {
				btn.style.bottom = defaultBottom + 'px';
			}
		}
	}

	function updateButtonVisibility(scrollY) {
		// Don't hide if at the top of the page (less than 200px)
		if (scrollY < 200) {
			btn.classList.remove('is-hidden-scroll');
			return;
		}

		// Hide when scrolling down, show when scrolling up
		if (isScrollingDown) {
			btn.classList.add('is-hidden-scroll');
		} else {
			btn.classList.remove('is-hidden-scroll');
		}
	}

	// Scroll to top on click
	btn.addEventListener('click', function() {
		window.scrollTo({ top: 0, behavior: 'smooth' });
	});

	// Throttled scroll handler
	var ticking = false;
	function onScroll() {
		if (!ticking) {
			window.requestAnimationFrame(function() {
				updateProgress();
				ticking = false;
			});
			ticking = true;
		}
	}

	window.addEventListener('scroll', onScroll, { passive: true });
	window.addEventListener('resize', onScroll, { passive: true });

	// Handle orientation change
	window.addEventListener('orientationchange', function() {
		setTimeout(function() {
			updateProgress();
		}, 100);
	}, { passive: true });

	// Initial update
	updateProgress();

	// Show button after a short delay
	setTimeout(function() {
		if (window.pageYOffset > 200) {
			btn.classList.add('is-visible');
			isVisible = true;
		}
	}, 500);
})();
</script>
{{/contentFor}}
